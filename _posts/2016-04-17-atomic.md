---
layout: post
title: AtomicInteger 
tags: lisp scheme eval
categories: lisp
---
## AtomicXXX
在java.concurrent.atomic包中，有很多基本数据的atomic类，以其中的AtomicInteger为例，分析一下他们的实现原理。
AtmoicInteger是Integer的原子类型，提供了compareAndSet等操作接口。在AtmoicInteger类的私有变量如下：

```Java
private static final Unsafe unsafe = Unsafe.getUnsafe();
private static final long valueOffset;

static {
	try {
		valueOffset = unsafe.objectFieldOffset
			(AtomicInteger.class.getDeclaredField("value"));
	} catch (Exception ex) { throw new Error(ex); }
}

private volatile int value;

```
在上述代码中，最重要的就是Unsafe，Unsafe是sun公司的未开源包中的类，能够进行很多的geek操作，可以对内存进行直接的操作，在AtomicInteger中，Unsafe类直接提供了compareAndSet操作支持。
```Java 
public final boolean compareAndSet(int expect, int update) {
	return unsafe.compareAndSwapInt(this, valueOffset, expect, update);
}
```
