---
layout: post
title: master bitcoin
tags: bitcoin
categories: bitcoin
---

## bitcoin介绍
bitcoin是中本聪于2009年创造的一种去中心化的分布式货币系统，通过称为区块链的分布式账本技术，实现了货币的发行和交易。bitcoin相比于之前的数字货币，最显著的特点就是去中心化，所有的节点通过P2P网络进行沟通。bitcoin不仅仅是一种数字货币，它还实现了去中心化的信任机制，使得交易双方的信任不在依赖于中心化的节点，这种去中心化的信任机制有可能会给社会带来巨大的变革。bitcoin的核心技术是区块链，一开始区块链的价值也是依靠bitcoin得以体现，当然随着区块链技术的发展，它也脱离bitcoin本身，具有更大的应用前景。
## 相关技术介绍
* HASH算法： SHA256
* Merkel tree<br>
Merkel tree能够快速的计算出多个数据块形成的数据的HASH值，通过树形结构将各个数据块的hash值组合起来，最终得到数据块的整体HASH值
* 非对称加密算法
* 数字签名
* P2P网络
* Pow（proof of work）<br>
工作证明，通过完成一些特殊格式的HASH值计算，比如4个0开头的hash值，来证明完成了一定量的工作，也就是一定量的时间，通过工作证明，结合一些特殊的策略，可以使得已经达成的共识无法被推翻
* UTXO，Unspent Transaction Output<br>
在bitcoin中，每一个资产都无法被拆分更细，只能完全交易或者完全不交易
* 复式记账

## Bitcoin的关键技术点


### bitcoin整体架构图


### bitcoin 用户密钥生成
在bitcoin系统中，用户的资产需要通过公私密钥对来确保。因此，用户在使用bitcoin之前，需要生成公私密钥对。其生成算法如下：<br>

![runtime][png1]


![runtime][png2]


<br>通过对用户生成的公钥进行hash，就能够得出用户的在bitcoin系统中的地址，这个地址可以用来接收bitcoin。通过公钥获得收款地址的算法如下：<br>

![runtime][png3]


### bitcoin的交易

如果李雷和韩梅梅之间要进行一笔金钱交易，那么该如何进行呢，其安全性有需要如何保证呢？如果是通过微信进行交易，交易流程如下：<br>

* 李雷通过扫码获得韩梅梅的账号地址
* 李雷输入金额、密码，并确认转账
* 韩梅梅查看自己的账户，确认钱已经收到

<br>
这笔交易有以下几个特点：

* 独占&授权。 李雷只能使用自己的钱，并且别人无法使用他的钱
* 安全&不可撤销。交易过程中，李雷转给韩梅梅的交易请求不会发生篡改，交易一旦达成，也无法撤销


如何通过bitcoin实现相同的交易呢？
<br>
首先，李雷需要提供自己资产的地址和授权。在bitcoin系统中，李雷需要提供他的账号和授权，也就是<sign(public key) , publick key>，该信息用于解锁他拥有的资产。<br>
然后，李雷发起交易请求，将交易信息广播出去，经过记账节点的确认之后，写入总账本链。<br>
最后，韩梅梅通过总账本链，确认交易完成。<br>

直观来说，如果需要保证交易能够正常进行，需要通过对交易的数据进行数字签名来确保不被篡改，利用利用公钥及其签名来证明所有权。那么，bitcoin又是如何保证交易的安全、独占以及不可撤销呢？<br>
在bitcoin中，用于存储交易信息的数据结构被称为区块链，如下所示：<br>

![runtime][png4]

<br>

区块链Header结构信息中，merkel根结点的值给出了当前数据块的HASH值，防止数据块被篡改，HASH需要满足目标值，所谓目标值，就是指前N位是0；前一个区块的记录信息确保了系统整个交易记录的完整性，也是本次计算的参数，这个值出来之前，是无法开始寻找随机数的计算的；随机数是用来使得merkel根满足目标值。目标值、前一个节点的HASH值以及merkel根信息结合一起，使得数据块的信息被篡改的成本大大提高。假设我们尝试对一个已经组织好的数据块进行篡改，那么我们需要重新找到合适的随机数，使得merkel根满足目标值，这个计算时间从概率上讲接近10分钟。例如，目标值是5，我们就需要找到一个随机数，使得当前数据块的merkel值的前5个数都是0，因为每一个位出现0的概率是1/16，平均我们需要计算16*5次hash值才能找到合适的随机数。在bitcoin中，所有的节点只会接受最长的链，因此，如果没有足够的计算能力，是无法比其他人形成更长的数据链的，也就保证了已形成的的数据块很难被篡改，事实上，需要51%的全系统计算能力才能够发起上述攻击，并且一旦形成了6个交易块之后，交易基本不可能撤销。对于已经形成的交易块，bitcoin提供了很好的保护能力，那么，如何保证生成块数据的节点是honest的呢？<br>
继续看交易记录结构，如下所示：<br>
![runtime][png5]

<br>
用户发起的每一个交易请求，包含了一个输入信息和多个输出信息，信息块会被用户签名，因此数据块无法被篡改。交易块信息中，用户提供自己的公钥和公钥签名作为输入解锁信息，输出信息包含目标的地址，也就是韩梅梅的公钥的hash值，这个hash值也是一个锁定脚本，只有能够提供该hash值对应的公钥信息和签名信息才能够使用输出的bitcoin。bitcoin使用chaincode技术来实现解锁和锁定脚本，如下图所示：<br>

![runtime][png6]

<br>
交易请求能够自身不被篡改，那么如何确保生成区块信息的用户会把该交易信息添加到数据链里面去呢,答案就是交易费用。每一笔交易费用的输入和输出之间的差值都会被当作交易费用，矿工通过寻找满足目标值的随机数，获得生成数据块的权利，伴随着生成数据块的权利，用户能够获得系统的奖励，这也是bitcoin的唯一生成方式，因此bitcoin是一个现有鸡再有蛋的过程。真实的bitcoin交易数据可以通过下面两个链接与上述结构进行对比：<br>

* https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.json

*    https://chainquery.com/bitcoin-api/getrawtransaction/f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16/1


### bitcoin的扩展

bitcoin是第一种能够进行分布式记账的数字货币，它代表了一种新的信任机制，这种机制也可以用在很多地方，比如染色比就是对bitcoin的扩展，它的主要价值不在于交易过程中bitcoin的数量，而是交易附加的信息，附加信息里面可以添加股权证明等等信息。另外，实现解锁和锁定脚本的chaincode并不是图灵完备的，Ethereum对Chaincode的能力进行了扩展，使其成为图灵完备的语言，从而具有实现智能合约的能力。除此之外，由于bitcoin是一个完全的p2p网络，与现实社会的组织结构不一样，以你Hyperledger在bitcoin基础上实现了差异化的网络结构。当然这些都是对bitcoin的一种改良，本质上来说还是一种bitcoin。

### 关于bitcoin的思考
bitcoin要成为能够广泛应用的货币，需要给参与的矿工足够的激励，同时，也需要防止一开始域外计算能力对整个bitcoin的攻击。加入整个bitcoin的计算能力为W，如果域外的计算能力为2W，那么2W可以很轻松地去伪造假的数据链。事实上，区块链的难度调整时间为2015个块链的计算速度，在bitcoin网络运行的早期，是可以进行攻击的。一旦运行的时间越来越长，基本上就不可能进行攻击的。为了避免这种攻击，可以在将整个网络暴露出来之前，先进行长时间的运算，同时需要将整个bitcoin的开始点的hash值写入协议中。<br>

bitcoin不仅仅是一种新型的货币，更是一种新型的信任关系。这种信任关系有助于社会的更小力度的结合，在冯.诺依曼的元包理论中，元包的无序运动会产生四种结构：<br>

* 整体布朗运动 
* 完全静止
* 完全规律化的运动
* 局部无序，但是整体上有序的运动

上面四种结构对社会的发展而言，第四种是唯一可取的。bitcoin所代表的新的信任机制，能够通过一定的策略，使得社会产生更大的碰撞能力，加速整个社会的进步呢，我们拭目以待。至于bitcoin本身的价值，相比于它所带来的信任机制，不过是九牛一毛。


[png1]: {{"/bt/bt-1.png" | prepend: site.imgrepo }}
[png2]: {{"/bt/bt-2.png" | prepend: site.imgrepo }}
[png3]: {{"/bt/bt-3.png" | prepend: site.imgrepo }}
[png4]: {{"/bt/bt-4.png" | prepend: site.imgrepo }}
[png5]: {{"/bt/bt-5.png" | prepend: site.imgrepo }}
[png6]: {{"/bt/bt-6.png" | prepend: site.imgrepo }}